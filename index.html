<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Woes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #07070a;
      --fg: #e6e6eb;

      --border: rgba(255,255,255,.10);
      --shadow: rgba(0,0,0,.78);

      /* IMPORTANT: comma-separated RGB so rgba(...) works everywhere */
      --accent: 120,255,180;
      --accent2: 120,180,255;

      --cardA: rgba(255,255,255,.040);
      --cardB: rgba(255,255,255,.022);

      --radius: 10px; /* squared */
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body{
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: var(--bg);
      color: var(--fg);
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      overflow: hidden;
    }

    canvas#runes{
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }

    .grain{
      position: fixed;
      inset: 0;
      z-index: 1;
      pointer-events: none;
      opacity: .07;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      background-size: 220px 220px;
      mix-blend-mode: overlay;
    }

    .vignette{
      position: fixed;
      inset: 0;
      z-index: 2;
      pointer-events: none;
      background: radial-gradient(1200px 900px at 50% 45%, rgba(0,0,0,0) 55%, rgba(0,0,0,.78) 100%);
      opacity: .95;
    }

    .card{
      position: relative;
      z-index: 3;
      padding: 1.35rem 2.15rem;
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--cardA), var(--cardB));
      border: 1px solid var(--border);
      box-shadow: 0 0 70px var(--shadow);
      backdrop-filter: blur(10px);
      overflow: hidden;
      transform: translateY(0);
      transition: transform .12s ease, box-shadow .22s ease, border-color .22s ease;
      user-select: none;
      cursor: default;
    }

    .card:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.16);
      box-shadow: 0 0 80px rgba(0,0,0,.82);
    }

    .card::before{
      content:"";
      position: absolute;
      inset: 7px;
      border-radius: calc(var(--radius) - 3px);
      border: 1px solid rgba(255,255,255,.075);
      pointer-events: none;
      z-index: 1;
    }

    /* AURA EDGE */
    .aura{
      position: absolute;
      inset: -2px;
      border-radius: calc(var(--radius) + 2px);
      pointer-events: none;
      z-index: 0;

      background:
        radial-gradient(120px 70px at 15% 20%, rgba(var(--accent), .35), transparent 65%),
        radial-gradient(160px 90px at 85% 70%, rgba(var(--accent2), .22), transparent 68%),
        conic-gradient(from 90deg,
          rgba(var(--accent), .00),
          rgba(var(--accent), .18),
          rgba(var(--accent), .00),
          rgba(var(--accent2), .14),
          rgba(var(--accent), .00)
        );

      filter: blur(12px);
      opacity: .55;
      mix-blend-mode: screen;
      animation: auraDrift 6.5s ease-in-out infinite;
    }

    @keyframes auraDrift{
      0%   { transform: rotate(0deg) scale(1.02); opacity: .45; }
      50%  { transform: rotate(9deg) scale(1.04); opacity: .65; }
      100% { transform: rotate(0deg) scale(1.02); opacity: .45; }
    }

    .card.pulse .aura{
      animation: auraPulse .85s ease-out 1;
      opacity: .85;
    }

    @keyframes auraPulse{
      0%   { transform: rotate(0deg) scale(1.02); filter: blur(12px); }
      45%  { transform: rotate(10deg) scale(1.09); filter: blur(15px); }
      100% { transform: rotate(0deg) scale(1.02); filter: blur(12px); }
    }

    .content{
      position: relative;
      z-index: 2;
      display: grid;
      place-items: center;
    }

    h1{
      margin: 0;
      font-family: "Cinzel", serif;
      font-size: clamp(2.25rem, 5vw, 2.9rem);
      font-weight: 600;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      text-shadow:
        0 0 14px rgba(var(--accent), .12),
        0 0 34px rgba(var(--accent), .06);
    }

    .sigil{
      margin-top: .55rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: .8rem;
      letter-spacing: .22em;
      color: rgba(230,230,235,.70);
      opacity: 0;
      transform: translateY(-4px);
      transition: opacity .22s ease, transform .22s ease;
      white-space: nowrap;
    }

    .sigil.show{
      opacity: 1;
      transform: translateY(0);
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 26px;
      transform: translateX(-50%);
      padding: .65rem .85rem;
      border-radius: 10px;
      background: rgba(0,0,0,.62);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 0 30px rgba(0,0,0,.8);
      color: rgba(230,230,235,.95);
      font-weight: 650;
      letter-spacing: .02em;
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 10;
    }

    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }

    .hint{
      position: fixed;
      top: 16px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      padding: .45rem .7rem;
      border-radius: 10px;
      background: rgba(0,0,0,.45);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(230,230,235,.70);
      font-weight: 650;
      letter-spacing: .02em;
      opacity: 0;
      pointer-events: none;
      transition: opacity .22s ease, transform .22s ease;
    }
    .hint.show{
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>

<body>
  <canvas id="runes"></canvas>
  <div class="grain"></div>
  <div class="vignette"></div>

  <main class="card" id="card" aria-label="Woes">
    <div class="aura"></div>
    <div class="content">
      <h1>Woes</h1>
      <div class="sigil" id="sigil">ᚹᛟᛖᛋ</div>
    </div>
  </main>

  <div class="hint" id="hint">Press <b>T</b> to change theme • Press <b>?</b> for keys</div>
  <div class="toast" id="toast">Theme</div>

  <script>
    // ===== Toast =====
    const toast = document.getElementById("toast");
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toast.classList.remove("show"), 900);
    }

    // ===== Themes (press T) =====
    const themes = [
      {
        name: "Emerald",
        vars: {
          "--bg": "#07070a",
          "--fg": "#e6e6eb",
          "--accent": "120,255,180",
          "--accent2": "120,180,255",
          "--cardA": "rgba(255,255,255,.040)",
          "--cardB": "rgba(255,255,255,.022)",
          "--radius": "10px"
        }
      },
      {
        name: "Ice",
        vars: {
          "--bg": "#06070b",
          "--fg": "#eef0ff",
          "--accent": "170,220,255",
          "--accent2": "150,255,210",
          "--cardA": "rgba(255,255,255,.042)",
          "--cardB": "rgba(255,255,255,.020)",
          "--radius": "10px"
        }
      },
      {
        name: "Ember",
        vars: {
          "--bg": "#070607",
          "--fg": "#f1eceb",
          "--accent": "255,160,110",
          "--accent2": "255,220,150",
          "--cardA": "rgba(255,255,255,.038)",
          "--cardB": "rgba(255,255,255,.020)",
          "--radius": "10px"
        }
      }
    ];

    let themeIndex = 0;

    function applyTheme(idx){
      const t = themes[idx];
      const root = document.documentElement;
      for (const [k,v] of Object.entries(t.vars)) root.style.setProperty(k, v);
      showToast(`Theme: ${t.name}`);
      localStorage.setItem("woes_theme", String(idx));
    }

    const savedTheme = Number(localStorage.getItem("woes_theme"));
    if (!Number.isNaN(savedTheme) && savedTheme >= 0 && savedTheme < themes.length){
      themeIndex = savedTheme;
      applyTheme(themeIndex);
    }

    // ===== Secrets =====
    const card = document.getElementById("card");
    const sigil = document.getElementById("sigil");
    const hint = document.getElementById("hint");

    let clicks = 0;
    let unlocked = localStorage.getItem("woes_unlocked") === "1";

    function setUnlocked(on){
      unlocked = on;
      localStorage.setItem("woes_unlocked", on ? "1" : "0");
      sigil.classList.toggle("show", on);
      hint.classList.toggle("show", on);
    }
    if (unlocked) setUnlocked(true);

    // Click 7 times to unlock
    card.addEventListener("click", () => {
      clicks++;
      if (clicks >= 7 && !unlocked){
        setUnlocked(true);
        showToast("Unlocked");
      } else if (clicks === 3 && !unlocked){
        showToast("…");
      }
      clearTimeout(card._ct);
      card._ct = setTimeout(() => { clicks = 0; }, 900);
    });

    // Hold W to pulse
    function pulse(){
      card.classList.remove("pulse");
      void card.offsetWidth; // retrigger
      card.classList.add("pulse");
      setTimeout(() => card.classList.remove("pulse"), 900);
    }

    let wHeld = false;
    let wTimer = null;

    function showKeys(){
      showToast("Keys: T = theme • Hold W = pulse • 7 clicks = unlock");
    }

    window.addEventListener("keydown", (e) => {
      const tag = (document.activeElement && document.activeElement.tagName || "").toLowerCase();
      if (tag === "input" || tag === "textarea") return;

      if (e.key === "t" || e.key === "T"){
        themeIndex = (themeIndex + 1) % themes.length;
        applyTheme(themeIndex);
      }

      if (e.key === "?"){
        showKeys();
      }

      if ((e.key === "w" || e.key === "W") && !wHeld){
        wHeld = true;
        clearTimeout(wTimer);
        wTimer = setTimeout(() => { if (wHeld) pulse(); }, 1200);
      }
    });

    window.addEventListener("keyup", (e) => {
      if (e.key === "w" || e.key === "W"){
        wHeld = false;
        clearTimeout(wTimer);
      }
    });

    // ===== Static Rune Wallpaper (low-lag) =====
    const canvas = document.getElementById("runes");
    const ctx = canvas.getContext("2d", { alpha: true });

    const GLYPHS = [
      "ᚠ","ᚢ","ᚦ","ᚨ","ᚱ","ᚲ","ᚷ","ᚹ","ᚺ","ᚾ","ᛁ","ᛃ","ᛇ","ᛈ","ᛉ","ᛋ","ᛏ","ᛒ","ᛖ","ᛗ","ᛚ","ᛜ","ᛞ","ᛟ",
      "⟡","⟠","⟟","⟐","⟁","⌁","⋄","⋆","⊕","⊗","⊘"
    ];

    const cfg = {
      cell: 26,
      font: 16,
      baseAlpha: 0.055,
      blinkAlpha: 0.20,
      blinkChance: 0.010,
      swapsPerTick: 12,
      tickHz: 9,
      cleanZoneStrength: 0.94
    };

    const tex = document.createElement("canvas");
    const t = tex.getContext("2d", { alpha: true });

    let cols = 0, rows = 0, n = 0;
    let cells, blink;

    const randGlyph = () => (Math.random() * GLYPHS.length) | 0;

    function getAccent(){
      // returns "r,g,b" e.g. "120,255,180"
      return getComputedStyle(document.documentElement).getPropertyValue("--accent").trim() || "120,255,180";
    }

    function resize(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      const texW = Math.max(cfg.cell * 24, Math.ceil(window.innerWidth / cfg.cell) * cfg.cell);
      const texH = Math.max(cfg.cell * 18, Math.ceil(window.innerHeight / cfg.cell) * cfg.cell);

      tex.width = Math.floor(texW * dpr);
      tex.height = Math.floor(texH * dpr);
      t.setTransform(dpr, 0, 0, dpr, 0, 0);

      cols = Math.ceil(texW / cfg.cell);
      rows = Math.ceil(texH / cfg.cell);
      n = cols * rows;

      cells = new Uint16Array(n);
      blink = new Float32Array(n);

      for (let i = 0; i < n; i++){
        cells[i] = randGlyph();
        blink[i] = 0;
      }

      rebuildTexture();
      drawOnce();
    }

    function tick(){
      for (let k = 0; k < cfg.swapsPerTick; k++){
        const a = (Math.random() * n) | 0;
        const b = (Math.random() * n) | 0;
        const tmp = cells[a]; cells[a] = cells[b]; cells[b] = tmp;
      }

      for (let i = 0; i < n; i++){
        if (blink[i] <= 0 && Math.random() < cfg.blinkChance){
          blink[i] = 1;
        }
      }

      for (let i = 0; i < n; i++){
        if (blink[i] > 0){
          blink[i] -= 0.10;
          if (blink[i] < 0) blink[i] = 0;
        }
      }

      rebuildTexture();
      drawOnce();
    }

    function rebuildTexture(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      const texW = tex.width / dpr;
      const texH = tex.height / dpr;

      t.clearRect(0, 0, texW, texH);
      t.textBaseline = "top";
      t.font = `${cfg.font}px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace`;

      const accent = getAccent(); // "r,g,b"

      let idx = 0;
      for (let y = 0; y < rows; y++){
        for (let x = 0; x < cols; x++){
          const gx = x * cfg.cell + 6;
          const gy = y * cfg.cell + 4;
          const ch = GLYPHS[cells[idx]];

          t.fillStyle = `rgba(230,230,235,${cfg.baseAlpha})`;
          t.fillText(ch, gx, gy);

          const b = blink[idx];
          if (b > 0){
            const a = b * cfg.blinkAlpha;
            t.fillStyle = `rgba(${accent},${a})`;
            t.fillText(ch, gx, gy);
            t.fillStyle = `rgba(${accent},${a * 0.55})`;
            t.fillText(ch, gx + 1, gy + 1);
          }

          idx++;
        }
      }
    }

    function drawOnce(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      const w = canvas.width / dpr;
      const h = canvas.height / dpr;
      const iw = tex.width / dpr;
      const ih = tex.height / dpr;

      ctx.clearRect(0, 0, w, h);

      for (let y = 0; y < h; y += ih){
        for (let x = 0; x < w; x += iw){
          ctx.drawImage(tex, x, y, iw, ih);
        }
      }

      const cx = w / 2;
      const cy = h / 2;
      const grad = ctx.createRadialGradient(cx, cy, 180, cx, cy, 520);
      grad.addColorStop(0, `rgba(7,7,10,${0.78 * cfg.cleanZoneStrength})`);
      grad.addColorStop(1, `rgba(7,7,10,0)`);
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, w, h);
    }

    let timer = null;
    function start(){
      if (timer) clearInterval(timer);
      timer = setInterval(tick, Math.round(1000 / cfg.tickHz));
    }

    resize();
    start();
    window.addEventListener("resize", resize);
  </script>
</body>
</html>
