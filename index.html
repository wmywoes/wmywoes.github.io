<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Woes Armory Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#07070a;
      --fg:#e8e8ef;
      --accent:#78ffb4;
      --card:rgba(255,255,255,.06);
      --border:rgba(255,255,255,.14);
      --muted:rgba(232,232,239,.72);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font-family:Inter,system-ui,-apple-system,Segoe UI,sans-serif;
      overflow:hidden;
    }

    #runes{position:fixed;inset:0;z-index:0;pointer-events:none}
    .grain,.vignette{position:fixed;inset:0;pointer-events:none}
    .grain{z-index:1;opacity:.06;background-image:radial-gradient(circle at 1px 1px,rgba(255,255,255,.28) 1px,transparent 0);background-size:3px 3px}
    .vignette{z-index:2;background:radial-gradient(1200px 900px at 50% 40%,rgba(0,0,0,0) 52%,rgba(0,0,0,.82) 100%)}

    main{
      position:relative;
      z-index:3;
      min-height:100%;
      display:grid;
      place-items:center;
      padding:24px;
    }

    .card{
      width:min(920px,100%);
      border:1px solid var(--border);
      border-radius:14px;
      background:linear-gradient(180deg,var(--card),rgba(255,255,255,.025));
      backdrop-filter:blur(8px);
      box-shadow:0 20px 80px rgba(0,0,0,.6);
      padding:22px;
    }

    h1{margin:0 0 8px;font-size:clamp(1.7rem,4vw,2.4rem);letter-spacing:.06em;text-transform:uppercase}
    p{margin:0;color:var(--muted)}

    form{display:flex;gap:10px;flex-wrap:wrap;margin:18px 0 8px}
    input,button{
      border-radius:10px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.28);
      color:var(--fg);
      padding:11px 13px;
      font-size:1rem;
    }
    input{flex:1;min-width:220px}
    button{cursor:pointer}
    button:hover{border-color:rgba(120,255,180,.55)}

    .status{min-height:22px;margin:10px 0 16px;color:var(--muted)}
    .status.error{color:#ff9fa2}
    .status.ok{color:#b8ffd9}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:14px}
    .panel{border:1px solid var(--border);border-radius:10px;padding:12px;background:rgba(0,0,0,.18)}
    .k{font-size:.82rem;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
    .v{font-size:1.28rem;font-weight:600;margin-top:4px}

    table{width:100%;border-collapse:collapse;font-size:.95rem}
    th,td{padding:8px 6px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left}
    th{color:var(--muted);font-weight:600}

    .hint{margin-top:12px;font-size:.9rem;color:var(--muted)}
  </style>
</head>
<body>
  <canvas id="runes"></canvas>
  <div class="grain"></div>
  <div class="vignette"></div>

  <main>
    <section class="card">
      <h1>OSRS Armory Prototype</h1>
      <p>First step: search a player and view core skill stats. Demo data is available if API access fails.</p>

      <form id="lookupForm">
        <input id="playerInput" name="player" placeholder="Enter RSN (e.g. Zezima)" autocomplete="off" required />
        <button type="submit">Lookup</button>
        <button type="button" id="demoBtn">Load Demo</button>
      </form>

      <div class="status" id="status"></div>

      <div class="grid">
        <div class="panel"><div class="k">Player</div><div class="v" id="playerName">-</div></div>
        <div class="panel"><div class="k">Total Level</div><div class="v" id="totalLevel">-</div></div>
        <div class="panel"><div class="k">Combat Level</div><div class="v" id="combatLevel">-</div></div>
      </div>

      <table>
        <thead><tr><th>Skill</th><th>Level</th><th>XP</th><th>Rank</th></tr></thead>
        <tbody id="skillsBody"><tr><td colspan="4">No data yet.</td></tr></tbody>
      </table>

      <p class="hint">Note: browser-to-OSRS API calls may fail due to CORS depending on endpoint policies. This prototype includes a demo fallback so UI work can continue.</p>
    </section>
  </main>

  <script>
  (function(){
    const DEMO = {
      name: "Demo Adventurer",
      stats: [
        ["Attack",82,2360000,120000], ["Defence",80,1980000,130000], ["Strength",85,3300000,99000], ["Hitpoints",84,3100000,100000],
        ["Ranged",79,1760000,140000], ["Prayer",70,737000,180000], ["Magic",81,2210000,110000], ["Cooking",90,5340000,78000],
        ["Woodcutting",76,1450000,170000], ["Mining",72,980000,210000], ["Fishing",75,1250000,190000], ["Firemaking",88,4600000,86000]
      ]
    };

    const skillsOrder = ["Attack","Defence","Strength","Hitpoints","Ranged","Prayer","Magic","Cooking","Woodcutting","Mining","Fishing","Firemaking"];

    const statusEl = document.getElementById("status");
    const playerNameEl = document.getElementById("playerName");
    const totalLevelEl = document.getElementById("totalLevel");
    const combatLevelEl = document.getElementById("combatLevel");
    const skillsBody = document.getElementById("skillsBody");
    const playerInput = document.getElementById("playerInput");

    function setStatus(msg, type="") {
      statusEl.className = `status ${type}`.trim();
      statusEl.textContent = msg;
    }

    function calcCombat(levels){
      const atk=levels.Attack||1, str=levels.Strength||1, def=levels.Defence||1;
      const hp=levels.Hitpoints||10, pray=levels.Prayer||1, rng=levels.Ranged||1, mag=levels.Magic||1;
      const base = 0.25 * (def + hp + Math.floor(pray / 2));
      const melee = 0.325 * (atk + str);
      const range = 0.325 * (Math.floor(rng * 1.5));
      const mage = 0.325 * (Math.floor(mag * 1.5));
      return Math.floor(base + Math.max(melee, range, mage));
    }

    function renderProfile(name, stats){
      const levels = {};
      let total = 0;
      skillsBody.innerHTML = "";

      for (const [skill, level, xp, rank] of stats){
        levels[skill] = level;
        total += Number(level) || 0;
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${skill}</td><td>${level}</td><td>${Number(xp).toLocaleString()}</td><td>${Number(rank).toLocaleString()}</td>`;
        skillsBody.appendChild(tr);
      }

      playerNameEl.textContent = name;
      totalLevelEl.textContent = total;
      combatLevelEl.textContent = calcCombat(levels);
    }

    async function fetchHiscores(player){
      const url = `https://secure.runescape.com/m=hiscore_oldschool/index_lite.ws?player=${encodeURIComponent(player)}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const text = await res.text();
      const rows = text.trim().split("\n");
      if (!rows.length) throw new Error("No rows returned");

      const parsed = [];
      for (let i = 0; i < skillsOrder.length; i++){
        const [rank, level, xp] = rows[i].split(",").map(Number);
        parsed.push([skillsOrder[i], level, xp, rank]);
      }
      return parsed;
    }

    async function handleLookup(player){
      setStatus("Looking up player...", "");
      try{
        const stats = await fetchHiscores(player);
        renderProfile(player, stats);
        setStatus("Live hiscores loaded.", "ok");
      }catch(err){
        renderProfile(DEMO.name, DEMO.stats);
        setStatus(`Live lookup failed (${err.message}). Showing demo profile.`, "error");
      }
    }

    document.getElementById("lookupForm").addEventListener("submit", (e)=>{
      e.preventDefault();
      handleLookup(playerInput.value.trim());
    });

    document.getElementById("demoBtn").addEventListener("click", ()=>{
      renderProfile(DEMO.name, DEMO.stats);
      setStatus("Demo profile loaded.", "ok");
    });

    // rune ambience
    const canvas = document.getElementById("runes");
    const ctx = canvas.getContext("2d");
    const glyphs = ["ᚠ","ᚢ","ᚦ","ᚨ","ᚱ","ᚲ","ᚷ","ᛃ","ᛟ","⋆","⟡","⌁"];
    let cols=0, rows=0;

    function resize(){
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      cols = Math.ceil(canvas.width / 26);
      rows = Math.ceil(canvas.height / 26);
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "rgba(230,230,238,.06)";
      ctx.font = "15px monospace";
      for (let y=0; y<rows; y++){
        for (let x=0; x<cols; x++){
          if (Math.random() < 0.3){
            const g = glyphs[(Math.random()*glyphs.length)|0];
            ctx.fillText(g, x*26+6, y*26+18);
          }
        }
      }
    }

    resize();
    draw();
    setInterval(draw, 220);
    window.addEventListener("resize", resize);
  })();
  </script>
</body>
</html>
